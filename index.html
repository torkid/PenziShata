<!DOCTYPE html>
<html lang="sw">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PenziShata - Video za Ukweli za Kibongo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Roboto+Condensed:wght@400;700&family=Teko:wght@700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        :root {
            --brand-red: #E50914;
        }
        body { 
            font-family: 'Roboto Condensed', sans-serif; /* Font kama ya YouTube */
            background-color: #0A0A0A;
            color: #f1f1f1;
        }
        .font-display {
            font-family: 'Teko', sans-serif;
        }
        
        /* Staili za Video Card (YouTube-style) */
        .video-list-card {
            margin-bottom: 1rem;
            cursor: pointer;
        }
        .video-thumbnail-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16 / 9; /* Aspect ratio ya video */
            background-color: #222;
            border-radius: 8px;
            overflow: hidden;
        }
        .video-thumbnail {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .video-duration {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background-color: rgba(0, 0, 0, 0.75);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.75rem; /* text-xs */
            font-weight: 700;
        }
        .video-details {
            padding-top: 12px;
            display: flex;
            align-items: flex-start; /* Picha ya channel iwe juu */
        }
        .channel-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: #333;
            margin-right: 12px;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: var(--brand-red);
        }
        .video-text-meta {
            overflow: hidden; /* Kuzuia title ndefu kuharibu layout */
        }
        .video-title {
            font-size: 1rem; /* text-base */
            font-weight: 700;
            color: #f1f1f1;
            line-height: 1.3;
            /* Kuficha text ndefu (ellipsis) */
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;  
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .video-channel-info {
            font-size: 0.875rem; /* text-sm */
            color: #aaa;
            margin-top: 4px;
        }

        /* Staili za Pagination (Unclickable) */
        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 1rem 0;
            border-top: 1px solid #222;
            margin-top: 1rem;
        }
        .pagination-item {
            padding: 8px 12px;
            margin: 0 4px;
            border-radius: 4px;
            font-weight: 700;
            color: #555; /* Rangi iliyofifia */
            background-color: #1a1a1a;
            cursor: not-allowed; /* Inaonyesha haibonyezwi */
        }
        .pagination-item.active {
            background-color: var(--brand-red);
            color: white;
        }

        /* Staili za Modal Mpya (Kama Picha) */
        .modal-card {
            background-color: #f3f4f6; /* Light gray background */
            color: #1f2937; /* Dark gray text */
            border-radius: 0.75rem; /* rounded-lg */
            padding: 2rem; /* p-8 */
            width: 100%;
            max-width: 28rem; /* max-w-sm */
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .icon-18 {
            width: 3.5rem; /* w-14 */
            height: 3.5rem; /* h-14 */
            background-color: #dc2626; /* bg-red-600 */
            border-radius: 9999px; /* rounded-full */
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.25rem; /* text-xl */
            font-weight: 700;
            border: 4px solid #111827; /* border-4 border-gray-900 */
            margin: 0 auto 1rem auto; /* Center */
        }
        .modal-title {
            font-size: 1.25rem; /* text-xl */
            font-weight: 700;
            text-align: center;
            color: #1f2937;
        }
        .modal-subtitle {
            font-size: 0.875rem; /* text-sm */
            color: #4b5563; /* text-gray-600 */
            text-align: center;
            margin-top: 0.5rem; /* mt-2 */
            max-width: 90%;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.4;
        }
        .modal-label {
            font-size: 0.875rem; /* text-sm */
            font-weight: 600; /* font-semibold */
            color: #374151; /* text-gray-700 */
            margin-top: 1.5rem; /* mt-6 */
            margin-bottom: 0.5rem; /* mb-2 */
        }
        .modal-input {
            width: 100%;
            border: 1px solid #d1d5db; /* border-gray-300 */
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.75rem 1rem; /* p-3 */
            font-size: 1.125rem; /* text-lg */
            color: #1f2937;
        }
        .modal-input:focus {
            outline: none;
            border-color: #6d28d9; /* purple-700 */
            box-shadow: 0 0 0 2px #c4b5fd; /* purple-200 ring */
        }
        .modal-button {
            width: 100%;
            background-color: #6d28d9; /* bg-purple-600 */
            color: white;
            border-radius: 0.375rem; /* rounded-md */
            padding: 0.75rem; /* p-3 */
            font-weight: 700;
            font-size: 1.125rem; /* text-lg */
            margin-top: 1.5rem; /* mt-6 */
            transition: background-color 0.2s ease;
        }
        .modal-button:hover {
            background-color: #5b21b6; /* bg-purple-700 */
        }
        .secure-payment {
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* text-gray-500 */
            margin-top: 1.5rem; /* mt-6 */
        }
        .payment-logos {
            margin-top: 1rem; /* mt-4 */
            text-align: center;
        }
        .payment-logos img {
            height: 24px; /* h-6 */
            display: inline-block;
            margin: 0 0.5rem; /* mx-2 */
        }
        .modal-footer-text {
            font-size: 0.75rem; /* text-xs */
            color: #6b7280; /* text-gray-500 */
            text-align: center;
            margin-top: 1.5rem; /* mt-6 */
        }

        /* Staili za ATM za zamani (zimefichwa) */
        .atm-screen, .atm-text, .atm-input, .atm-button, .loading-circle, .blinking-text, .bouncing-emoji {
            display: none;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Main Container -->
    <div class="relative min-h-screen flex flex-col">

        <!-- Header Mpya -->
        <header class="w-full py-3 px-4 sm:px-8 border-b border-gray-800 sticky top-0 bg-black/70 backdrop-blur-md z-30">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-3xl sm:text-4xl font-black uppercase text-red-600 font-display tracking-wider">
                    PenziShata
                </h1>
                <button class="open-modal-trigger bg-red-600 hover:bg-red-700 transition-all text-white font-bold py-2 px-6 rounded-lg text-sm sm:text-base animate-pulse shadow-lg shadow-red-500/30">
                    Jiunge VIP (TSH 2,000)
                </button>
            </div>
        </header>

        <!-- Main Content (Video List) -->
        <main class="flex-grow flex flex-col w-full max-w-xl mx-auto p-4 sm:p-8">
            
            <!-- Hapa ndipo video zitawekwa na JavaScript -->
            <div id="video-list-container">
                <!-- Mfano wa Card (itaondolewa na JS) -->
                <div class="video-list-card">
                    <div class="video-thumbnail-container bg-gray-700 animate-pulse"></div>
                    <div class="video-details">
                        <div class="channel-avatar bg-gray-700 animate-pulse"></div>
                        <div class="video-text-meta w-full">
                            <div class="video-title h-5 bg-gray-700 rounded w-3/4 animate-pulse mb-2"></div>
                            <div class="video-channel-info h-4 bg-gray-700 rounded w-1/2 animate-pulse"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Pagination (Unclickable) -->
            <nav class="pagination" aria-label="Pagination">
                <span class="pagination-item active" aria-current="page">1</span>
                <span class="pagination-item">2</span>
                <span class="pagination-item">3</span>
                <span class="pagination-item">...</span>
                <span class="pagination-item">
                    <i class="fas fa-chevron-right"></i>
                </span>
            </nav>
            
        </main>

        <!-- Footer -->
        <footer class="w-full py-8 px-4 sm:px-8 mt-12 border-t border-white/10">
            <div class="container mx-auto text-center text-gray-500">
                <p>&copy; 2025 PenziShata. Haki zote zimehifadhiwa.</p>
                <div class="mt-2 text-sm">
                    <a href="#" class="hover:text-white mx-2">Vigezo & Masharti</a>
                    <span class="text-gray-600">•</span>
                    <a href="#" class="hover:text-white mx-2">Sera ya Faragha</a>
                </div>
            </div>
        </footer>

    </div>
    
    <!-- Payment Modal MPYA (Kama Picha) -->
    <div id="payment-modal" class="fixed inset-0 bg-black bg-opacity-70 backdrop-blur-sm flex items-center justify-center p-4 z-50 hidden">
         <div id="payment-box" class="modal-card relative">
            <button id="close-modal" class="absolute top-3 right-4 text-gray-400 hover:text-gray-600 text-3xl font-light z-20">&times;</button>
            
            <!-- Form View -->
            <div id="form-view">
                <div class="icon-18">18+</div>
                <h2 class="modal-title">LIPIA TSH 2000/= TU.</h2>
                <p class="modal-subtitle">Video zote za kiku bwa pamoja na connection kali na Mpya za Mjini Utazipata hapa</p>
                
                <form id="payment-form">
                    <label for="phone" class="modal-label">Weka namba yenye pesa *</label>
                    <input type="tel" id="phone" name="phone" class="modal-input" placeholder="07XXXXXXXX" required pattern="0[6-7][0-9]{8}">
                    <button type="submit" class="modal-button">
                        <i class="fas fa-lock mr-2"></i> LIPA SASA
                    </button>
                </form>

                <div class="secure-payment">
                    <i class="fas fa-lock w-4 h-4 mr-2"></i> Secure Payment
                </div>
                
                <div class="payment-logos">
                    <!-- Nimetumia logo moja ya ZenoPay kama ilivyokuwa kwenye file la kwanza, inawakilisha zote -->
                    <img src="https://i.ibb.co/jvqbh208/zenopay-logo.png" alt="Watoa Huduma" class="h-8 mx-auto">
                </div>
                
                <p class="modal-footer-text">You're supporting PenziShata with this payment.</p>
            </div>

            <!-- Loading View (Inatumia style mpya) -->
            <div id="waiting-view" class="hidden h-full flex flex-col items-center justify-center text-center py-10">
                <div class="w-16 h-16 border-4 border-purple-600 border-t-transparent rounded-full animate-spin"></div>
                <h3 class="modal-title mt-6 text-purple-700">ANGALIA SIMU YAKO!</h3>
                <p class="modal-subtitle mt-2">Tumekutumia ombi la malipo. Weka namba yako ya siri kumaliza.</p>
                <p class="font-bold text-gray-500 mt-4 animate-pulse">INASUBIRI UTHIBITISHO...</p>
            </div>
        </div>
    </div>

    <script>
        // Data mpya ya video
        const videoSources = [
            { title: "KUZIMIA UTAMU: Mkundu wa Kizaramo", duration: "12:45", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/13/134/13452687/13452687-preview.webm" },
            { title: "Mboo Ya Kwanza Gesti: Kujirusha", duration: "08:11", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/13/134/13452678/13452678-preview.webm" },
            { title: "WAPENZI WA CHUO Kikuu: Ufundi wa Chini", duration: "05:59", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/124/12444399/12444399-preview.webm" },
            { title: "BIBI YA MTU: Siri Za Wake wa Kijerumani", duration: "15:02", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/13/134/13452698/13452698-preview.webm" },
            { title: "HOUSEGIRL Kwenye Kiti cha Bosi", duration: "09:30", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/13/130/13060359/13060359-preview.webm" },
            { title: "MAKUNDU MATAMU: Tigo pesa inatumika!", duration: "07:44", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/120/12040346/12040346-preview.webm" },
            { title: "KUKOJOA BILA KUSIMAMA: Daktari wa Kichaa", duration: "11:21", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/13/131/13172572/13172572-preview.webm" },
            { title: "MKUNDU WA MZITO: Shemeji Anavyoiba", duration: "06:33", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/13/131/13172048/13172048-preview.webm" },
            { title: "CHAFU LA MWANZA: Kwenye Gari Rahisi", duration: "14:01", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/13/131/13172064/13172064-preview.webm" },
            { title: "MTOTO WA KIARABU: Anakojolea iPhone", duration: "10:07", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/13/133/13382197/13382197-preview.webm" },
            { title: "TOTO LA SINZA: Limeshindwa Kumwaga", duration: "09:55", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/124/12463982/12463982-preview.webm" },
            { title: "ASKARI KINZANI: Anavuliwa Nguo", duration: "08:22", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/120/12097517/12097517-preview.webm" },
            { title: "BINTI KIZIWI: Anashangaa Mboo", duration: "04:50", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/121/12165824/12165824-preview.webm" },
            { title: "WEMA SEPETU (MNAFKI): Mambo ya Chini", duration: "13:40", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/123/12379453/12379453-preview.webm" },
            { title: "MKUNDU WA KIJOMBE: Anawaka Moto", duration: "07:05", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/120/12097526/12097526-preview.webm" },
            { title: "CHABO LA MGANGA: Anatumia Fimbo", duration: "05:15", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/120/12097349/12097349-preview.webm" },
            { title: "MAMA WA KANISA: Anajirusha Kanisani", duration: "11:50", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/122/12271419/12271419-preview.webm" },
            { title: "KUJICHUA CHUMBANI: Kwa Kutumia Mafuta", duration: "06:19", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/121/12116404/12116404-preview.webm" },
            { title: "VIBIBI VYA KISHENZI: Utamu Bila Mipaka", duration: "14:59", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/120/12099511/12099511-preview.webm" },
            { title: "KIJANA MDOGO: Anapiga Mshua Mkubwa", duration: "10:20", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/121/12165715/12165715-preview.webm" },
            { title: "MBOO YA TRAFFIC: Anawapiga Wote", duration: "07:31", src:"https://static-eu-cdn.eporner.com/thumbs/static4/1/12/123/12379994/12379994-preview.webm" },
            { title: "MBOO YENYE FIMBO: Kwenye Choo cha Gesti", duration: "12:08", src: "https://static-eu-cdn.eporner.com/thumbs/static4/1/12/124/12429864/12429864-preview.webm" }
        ];

        // Majina ya Channels (fake)
        const channelNames = [
            "Ulimwengu wa Nyege", "Bongo Flava Sex", "Chabo la Mjini", "Gesti za Sinza", "Warembo TV", "Utamu Live"
        ];

        document.addEventListener('DOMContentLoaded', () => {

            // --- Element References ---
            const videoListContainer = document.getElementById('video-list-container');
            
            // Modal elements
            const paymentModal = document.getElementById('payment-modal');
            const closeModalButton = document.getElementById('close-modal');
            const formView = document.getElementById('form-view');
            const waitingView = document.getElementById('waiting-view');
            const paymentForm = document.getElementById('payment-form');
            const paymentBox = document.getElementById('payment-box');

            // --- Function to create a video card (YouTube-style) ---
            const createVideoCard = (video) => {
                const channelName = channelNames[Math.floor(Math.random() * channelNames.length)];
                const views = (Math.floor(Math.random() * 900) + 100) + 'K';
                const age = (Math.floor(Math.random() * 5) + 1) + ' days ago';
                const avatarLetter = channelName.charAt(0).toUpperCase();

                const card = document.createElement('div');
                card.className = 'video-list-card open-modal-trigger';
                
                card.innerHTML = `
                    <div class="video-thumbnail-container">
                        <video class="video-thumbnail" loop muted playsinline src="${video.src}"></video>
                        <span class="video-duration">${video.duration}</span>
                    </div>
                    <div class="video-details">
                        <div class="channel-avatar" style="background-color: #${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}30; color: #${Math.floor(Math.random()*16777215).toString(16).padStart(6, '0')}">
                            ${avatarLetter}
                        </div>
                        <div class="video-text-meta">
                            <h3 class="video-title">${video.title}</h3>
                            <div class="video-channel-info">
                                <span>${channelName}</span> &bull;
                                <span>${views} views</span> &bull;
                                <span>${age}</span>
                            </div>
                        </div>
                    </div>
                `;
                
                // Add hover to play functionality
                const videoEl = card.querySelector('video');
                card.addEventListener('mouseenter', () => videoEl.play().catch(e => {}));
                card.addEventListener('mouseleave', () => {
                    videoEl.pause();
                    videoEl.currentTime = 0; // Reset video to start
                });

                return card;
            };

            // --- Jaza Video List ---
            if (videoListContainer) {
                videoListContainer.innerHTML = ''; // Futa loading state
                videoSources.sort(() => 0.5 - Math.random()).forEach(video => {
                    videoListContainer.appendChild(createVideoCard(video));
                });
            }

            // --- Modal Logic ---
            const openModal = () => paymentModal.classList.remove('hidden');
            const closeModal = () => {
                paymentModal.classList.add('hidden');
                setTimeout(() => {
                    formView.style.display = 'block';
                    waitingView.style.display = 'none';
                }, 300);
            };
            
            // Weka listeners kwenye button zote (pamoja na zile mpya za video)
            document.querySelectorAll('.open-modal-trigger').forEach(trigger => {
                trigger.addEventListener('click', (e) => {
                    e.preventDefault();
                    openModal();
                });
            });

            closeModalButton.addEventListener('click', closeModal);
            paymentModal.addEventListener('click', (event) => {
                // Funga modal tu ikiwa user amebonyeza background nyeusi
                if (event.target === paymentModal) {
                    closeModal();
                }
            });

            // Payment Form Logic
            if (paymentForm) {
                paymentForm.addEventListener('submit', (e) => {
                    e.preventDefault();
                    formView.style.display = 'none';
                    waitingView.style.display = 'flex'; // Onyesha loading mpya
                    
                    setTimeout(async () => {
                        const phone = document.getElementById('phone').value;
                        try {
                            const response = await fetch('/pay', {
                                method: 'POST',
                                headers: { 'Content-Type': 'application/json' },
                                body: JSON.stringify({ phone: phone })
                            });
                            const result = await response.json();
                            if (!response.ok) {
                                throw new Error(result.message_body || 'Ombi la malipo halikufanikiwa.');
                            }
                            // Mtumiaji sasa anasubiri USSD push
                            // Hatufanyi 'alert' hapa, modal inabaki wazi
                        } catch (error) {
                            // Ikifeli, rudisha form
                            waitingView.style.display = 'none';
                            formView.style.display = 'block';
                            // Hapa unaweza kuonyesha error message ndani ya modal
                            alert("Tatizo limetokea: " + error.message);
                        }
                    }, 1500); // Subiri kidogo kuonyesha loading
                });
            }
        });
    </script>
</body>
</html>

